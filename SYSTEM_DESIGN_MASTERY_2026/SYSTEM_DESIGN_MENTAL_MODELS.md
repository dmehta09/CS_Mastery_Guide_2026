# System Design Mental Models for Mastery

## 1. The Restaurant Analogy - Complete System Overview

```
A Distributed System = A Restaurant Chain

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        THE RESTAURANT CHAIN                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  CUSTOMERS                    FRONT OF HOUSE           BACK OF HOUSE â”‚
â”‚  (Users)                      (API Layer)              (Services)    â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ğŸ‘¤ğŸ‘¤ğŸ‘¤â”‚ â”€â”€â”€ Reservations â”€â”€â–º â”‚  Host     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚  Kitchen  â”‚ â”‚
â”‚  â”‚ğŸ‘¤ğŸ‘¤ğŸ‘¤â”‚     (Requests)       â”‚  Stand    â”‚           â”‚  Stations â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜                      â”‚ (API GW)  â”‚           â”‚ (Services)â”‚ â”‚
â”‚                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                    â”‚                        â”‚       â”‚
â”‚                               â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â” â”‚
â”‚                               â”‚ Waiters â”‚             â”‚  Pantry   â”‚ â”‚
â”‚                               â”‚(Load    â”‚             â”‚  (Cache)  â”‚ â”‚
â”‚                               â”‚Balancer)â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚       â”‚
â”‚                                    â”‚                   â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”  â”‚
â”‚                               â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”             â”‚ Storage â”‚  â”‚
â”‚                               â”‚ Tables  â”‚             â”‚ (DB)    â”‚  â”‚
â”‚                               â”‚(Servers)â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ MAPPING:                                                             â”‚
â”‚ â€¢ Host Stand = API Gateway (routing, authentication)                 â”‚
â”‚ â€¢ Waiters = Load Balancers (distribute work)                        â”‚
â”‚ â€¢ Tables = Servers (handle requests)                                â”‚
â”‚ â€¢ Kitchen = Backend Services (do the real work)                     â”‚
â”‚ â€¢ Pantry = Cache (quick access to common items)                     â”‚
â”‚ â€¢ Storage Room = Database (persistent storage)                      â”‚
â”‚ â€¢ Multiple Locations = Multiple Regions (geo-distribution)          â”‚
â”‚ â€¢ Recipe Book = Schema (data structure)                             â”‚
â”‚ â€¢ Kitchen Display = Message Queue (order management)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. The CAP Triangle - Distributed System Trade-offs

```
                         CONSISTENCY
                             /\
                            /  \
                           /    \
                          /  CP  \     â† Banks, Stock Trading
                         /   â–²    \       (Sacrifice Availability)
                        /    â”‚     \
                       /     â”‚      \
                      /â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€\
                     /       â”‚        \
                    /   CA   â”‚   AP    \
                   /   (Not  â”‚  â–²      \  â† Social Media, DNS
                  / Possible)â”‚         \    (Sacrifice Consistency)
                 /___________â”‚__________\
          AVAILABILITY â—„â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â–º PARTITION TOLERANCE
                                       (Must have in distributed)

PICK TWO (But P is mandatory in distributed systems):

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CP Systems      â”‚ Consistent + Partition-tolerant                 â”‚
â”‚                 â”‚ â€¢ Blocks during partition (sacrifices A)        â”‚
â”‚                 â”‚ â€¢ Examples: ZooKeeper, etcd, HBase, MongoDB*    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ AP Systems      â”‚ Available + Partition-tolerant                  â”‚
â”‚                 â”‚ â€¢ Returns stale data during partition           â”‚
â”‚                 â”‚ â€¢ Examples: Cassandra, DynamoDB, CouchDB        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ CA Systems      â”‚ Only possible on single node (no partitions)    â”‚
â”‚                 â”‚ â€¢ Traditional RDBMS on single server            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

THE PACELC EXTENSION:
If Partition â†’ (A or C), Else â†’ (Latency or Consistency)

                    Network Partition?
                          â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             Yes                      No
              â”‚                        â”‚
      Choose A or C?          Choose L or C?
         â”‚       â”‚               â”‚       â”‚
         â–¼       â–¼               â–¼       â–¼
        PA      PC              EL      EC
    (Available)(Consistent) (Low Lat)(Consistent)
```

---

## 3. The Consistency Spectrum

```
STRONGEST â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º WEAKEST
(Slowest)                                               (Fastest)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚LINEARIZABLEâ”‚ SEQUENTIAL â”‚   CAUSAL   â”‚  SESSION   â”‚ EVENTUAL   â”‚
â”‚            â”‚            â”‚            â”‚            â”‚            â”‚
â”‚ Real-time  â”‚ Total orderâ”‚ Causeâ†’     â”‚ Your own   â”‚ Eventually â”‚
â”‚ ordering   â”‚ preserved  â”‚ Effect     â”‚ writes     â”‚ converges  â”‚
â”‚            â”‚            â”‚ ordered    â”‚ visible    â”‚            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Spanner  â”‚   ZooKeeperâ”‚  MongoDB   â”‚ DynamoDB   â”‚ Cassandra  â”‚
â”‚   CockroachDB          â”‚            â”‚            â”‚  DNS       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Visual: Reading a Newspaper

LINEARIZABLE:     Everyone reads EXACT same news at EXACT same time
SEQUENTIAL:       Everyone reads same articles in same ORDER
CAUSAL:          Reply tweets always appear after original tweet
SESSION:         You see YOUR OWN posts immediately
EVENTUAL:        News reaches different cities at different times
                 (but eventually everyone knows)
```

---

## 4. The Scaling Dimensions

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    SCALING OPTIONS       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   VERTICAL      â”‚    â”‚   HORIZONTAL    â”‚    â”‚   DIAGONAL      â”‚
â”‚   (Scale Up)    â”‚    â”‚   (Scale Out)   â”‚    â”‚   (Both)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚ â”Œâ”€â”€â” â”Œâ”€â”€â” â”Œâ”€â”€â” â”‚    â”‚  â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â”    â”‚
â”‚  â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”‚   â”‚    â”‚ â”‚â–ˆâ–ˆâ”‚ â”‚â–ˆâ–ˆâ”‚ â”‚â–ˆâ–ˆâ”‚ â”‚    â”‚  â”‚â–ˆâ–ˆâ–ˆâ”‚ â”‚â–ˆâ–ˆâ–ˆâ”‚    â”‚
â”‚  â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”‚   â”‚    â”‚ â””â”€â”€â”˜ â””â”€â”€â”˜ â””â”€â”€â”˜ â”‚    â”‚  â”‚â–ˆâ–ˆâ–ˆâ”‚ â”‚â–ˆâ–ˆâ–ˆâ”‚    â”‚
â”‚  â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”‚   â”‚    â”‚ â”Œâ”€â”€â” â”Œâ”€â”€â” â”Œâ”€â”€â” â”‚    â”‚  â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜    â”‚
â”‚  â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”‚   â”‚    â”‚ â”‚â–ˆâ–ˆâ”‚ â”‚â–ˆâ–ˆâ”‚ â”‚â–ˆâ–ˆâ”‚ â”‚    â”‚  â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â”    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚ â””â”€â”€â”˜ â””â”€â”€â”˜ â””â”€â”€â”˜ â”‚    â”‚  â”‚â–ˆâ–ˆâ–ˆâ”‚ â”‚â–ˆâ–ˆâ–ˆâ”‚    â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚  â”‚â–ˆâ–ˆâ–ˆâ”‚ â”‚â–ˆâ–ˆâ–ˆâ”‚    â”‚
â”‚ Bigger Machine  â”‚    â”‚ More Machines   â”‚    â”‚  â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ“ Simple        â”‚    â”‚ âœ“ Unlimited     â”‚    â”‚ âœ“ Optimized     â”‚
â”‚ âœ— Has ceiling   â”‚    â”‚ âœ“ Fault tolerantâ”‚    â”‚ âœ— Complex       â”‚
â”‚ âœ— Single point  â”‚    â”‚ âœ— Complexity    â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

SCALING DECISION TREE:

            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Need to handle more load â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Is app stateless?       â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    Yes  â”‚  No
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼                               â–¼
    Horizontal              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    scaling easy            â”‚ Can state be       â”‚
                            â”‚ externalized?      â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               Yes    â”‚    No
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼                                   â–¼
               Externalize                        Vertical scale
               state (Redis)                      + Sharding
               then scale out
```

---

## 5. The Database Selection Matrix

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚      WHAT TYPE OF DATA/ACCESS?       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”´â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼               â–¼               â–¼       â–¼               â–¼               â–¼
STRUCTURED      DOCUMENTS       KEY-VALUE  GRAPHS      TIME-SERIES      SEARCH
    â”‚               â”‚               â”‚         â”‚             â”‚               â”‚
    â–¼               â–¼               â–¼         â–¼             â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SQL  â”‚      â”‚ MongoDB â”‚    â”‚  Redis  â”‚ â”‚ Neo4j â”‚   â”‚InfluxDB   â”‚  â”‚Elastic-  â”‚
â”‚(ACID) â”‚      â”‚ CouchDB â”‚    â”‚DynamoDB â”‚ â”‚Neptuneâ”‚   â”‚Timescale  â”‚  â”‚search    â”‚
â”‚       â”‚      â”‚ Firestoreâ”‚   â”‚ Riak    â”‚ â”‚       â”‚   â”‚           â”‚  â”‚          â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
    â”‚               â”‚              â”‚          â”‚             â”‚             â”‚
    â–¼               â–¼              â–¼          â–¼             â–¼             â–¼
Complex         Flexible       Blazing    Connected    Metrics,      Full-text,
joins,          schema,        fast,      data,        IoT,          Relevance,
transactions    nesting        simple     traversals   Events        Analytics


DECISION QUESTIONS:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Q1: Do I need ACID transactions across multiple tables?                     â”‚
â”‚     YES â†’ SQL (PostgreSQL, MySQL)                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Q2: Is my schema changing frequently / semi-structured?                     â”‚
â”‚     YES â†’ Document Store (MongoDB, DynamoDB)                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Q3: Do I need sub-millisecond access by key?                               â”‚
â”‚     YES â†’ Key-Value / Cache (Redis, Memcached)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Q4: Am I modeling relationships (friends, followers, paths)?               â”‚
â”‚     YES â†’ Graph Database (Neo4j, Neptune)                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Q5: Is it time-stamped metrics/events at high volume?                      â”‚
â”‚     YES â†’ Time-series Database (InfluxDB, TimescaleDB)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Q6: Do I need full-text search with relevance scoring?                     â”‚
â”‚     YES â†’ Search Engine (Elasticsearch, OpenSearch)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Q7: Is it AI/ML embeddings for similarity search?                          â”‚
â”‚     YES â†’ Vector Database (Pinecone, Milvus, pgvector)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. The Caching Strategy Decision Tree

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Where should I cache?  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â–¼              â–¼           â–¼           â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Browser â”‚   â”‚   CDN   â”‚ â”‚API Gate â”‚ â”‚App Layerâ”‚   â”‚Database â”‚
â”‚ Cache   â”‚   â”‚  Edge   â”‚ â”‚  Cache  â”‚ â”‚ (Redis) â”‚   â”‚  Cache  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚Static   â”‚   â”‚Static + â”‚ â”‚Response â”‚ â”‚Session, â”‚   â”‚Query    â”‚
â”‚assets   â”‚   â”‚some API â”‚ â”‚caching  â”‚ â”‚Objects  â”‚   â”‚cache    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚              â”‚           â”‚           â”‚              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
            Distance from user â”‚ Closer = Faster
                               â–¼
    Browser â†’ CDN â†’ API Gateway â†’ Application â†’ Database


CACHE PATTERNS:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CACHE-ASIDE (Lazy Loading)                                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚  App â”€â”€â–º Cache hit? â”€â”€â–º YES â”€â”€â–º Return cached                        â”‚   â”‚
â”‚ â”‚   â”‚                                                                   â”‚   â”‚
â”‚ â”‚   â””â”€â”€â”€â–º NO â”€â”€â–º Read DB â”€â”€â–º Store in cache â”€â”€â–º Return                 â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚ USE: Most common, lazy population, stale data OK                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ WRITE-THROUGH                                                               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚  Write â”€â”€â–º Update Cache â”€â”€â–º Update DB (sync) â”€â”€â–º Return              â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚ USE: Strong consistency needed, write latency OK                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ WRITE-BEHIND (Write-Back)                                                   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚  Write â”€â”€â–º Update Cache â”€â”€â–º Return â”€â”€â–º Async update DB               â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚ USE: High write throughput, can lose some data                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ READ-THROUGH                                                                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚  App â”€â”€â–º Cache (cache handles DB read if miss) â”€â”€â–º Return            â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚ USE: Simplified app code, cache manages fetching                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


CACHE INVALIDATION (The Hard Part):

         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚      How to keep cache fresh?          â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â–¼                     â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   TTL     â”‚         â”‚  Events   â”‚         â”‚ Versioned â”‚
â”‚ (Expire)  â”‚         â”‚ (Publish) â”‚         â”‚   Keys    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Simple    â”‚         â”‚ Real-time â”‚         â”‚ Atomic    â”‚
â”‚ Stale OK  â”‚         â”‚ Complex   â”‚         â”‚ switches  â”‚
â”‚ 5 min TTL â”‚         â”‚ On write, â”‚         â”‚ user:v2:  â”‚
â”‚           â”‚         â”‚ invalidateâ”‚         â”‚ profile   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. The Load Balancing Playbook

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚         LOAD BALANCER LAYERS         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    LAYER 4 (Transport)              LAYER 7 (Application)
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   TCP/UDP Level     â”‚         â”‚   HTTP/HTTPS Level  â”‚
    â”‚                     â”‚         â”‚                     â”‚
    â”‚ â€¢ Faster (no        â”‚         â”‚ â€¢ Content-aware     â”‚
    â”‚   inspection)       â”‚         â”‚   routing           â”‚
    â”‚ â€¢ IP + Port only    â”‚         â”‚ â€¢ Path-based rules  â”‚
    â”‚ â€¢ Can't see content â”‚         â”‚ â€¢ Header inspection â”‚
    â”‚ â€¢ NLB, HAProxy L4   â”‚         â”‚ â€¢ SSL termination   â”‚
    â”‚                     â”‚         â”‚ â€¢ ALB, NGINX, Envoy â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


ALGORITHM SELECTION:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Round Robin         â”‚ Simple rotation. Equal servers.                â”‚
â”‚ â—‹ â†’ â—‹ â†’ â—‹ â†’ â—‹ â†’    â”‚ USE: Homogeneous servers, stateless apps       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Weighted Round Robinâ”‚ Some servers handle more.                      â”‚
â”‚ â—‹ â†’ â—â— â†’ â—‹ â†’ â—â— â†’ â”‚ USE: Different server capacities                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Least Connections   â”‚ Send to least busy.                            â”‚
â”‚ â—‹(5) â—‹(3)â† â—‹(8)    â”‚ USE: Long-lived connections, variable work     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ IP Hash             â”‚ Same client â†’ same server.                     â”‚
â”‚ Client IP â†’ Hash â†’  â”‚ USE: Session stickiness needed                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Least Response Time â”‚ Fastest server gets traffic.                   â”‚
â”‚ 10msâ† 50ms 30ms    â”‚ USE: Response time matters, health varies      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Random              â”‚ Random selection.                              â”‚
â”‚ â—‹ ? â—‹ ? â—‹          â”‚ USE: Simple, surprisingly effective            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


GLOBAL LOAD BALANCING:

                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚            USER                 â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚ DNS Query
                                    â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚      Global DNS (Route 53)      â”‚
                    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                    â”‚   â”‚ Routing Policies:       â”‚   â”‚
                    â”‚   â”‚ â€¢ Latency-based         â”‚   â”‚
                    â”‚   â”‚ â€¢ Geolocation           â”‚   â”‚
                    â”‚   â”‚ â€¢ Weighted              â”‚   â”‚
                    â”‚   â”‚ â€¢ Failover              â”‚   â”‚
                    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â–¼                     â–¼                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚US-EAST-1 â”‚          â”‚EU-WEST-1 â”‚          â”‚AP-SOUTH-1â”‚
        â”‚   ALB    â”‚          â”‚   ALB    â”‚          â”‚   ALB    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. The Messaging Mental Model

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚      MESSAGE PATTERN SELECTION       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚ One-to-One or     â”‚
                              â”‚ One-to-Many?      â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼                                       â–¼
              ONE-TO-ONE                              ONE-TO-MANY
              (Queue)                                 (Pub/Sub)
                    â”‚                                       â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â–¼                   â–¼               â–¼                           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚    SQS    â”‚      â”‚  RabbitMQ â”‚   â”‚    SNS    â”‚              â”‚   Kafka   â”‚
    â”‚  (Simple) â”‚      â”‚ (Complex) â”‚   â”‚(Push/Fan) â”‚              â”‚ (Stream)  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


QUEUE vs STREAM:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              QUEUE                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Producer â”€â–º â”‚ M1 â”‚ M2 â”‚ M3 â”‚ â”€â–º Consumer                              â”‚ â”‚
â”‚  â”‚              â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜                                          â”‚ â”‚
â”‚  â”‚  â€¢ Message disappears after consumed                                   â”‚ â”‚
â”‚  â”‚  â€¢ One consumer per message (competing consumers)                      â”‚ â”‚
â”‚  â”‚  â€¢ Good for: Task queues, job processing                               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  Examples: SQS, RabbitMQ, ActiveMQ                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                              STREAM                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Producer â”€â–º â”‚ M1 â”‚ M2 â”‚ M3 â”‚ M4 â”‚ M5 â”‚ â”€â–º Consumer A (offset: 3)     â”‚ â”‚
â”‚  â”‚              â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜ â”€â–º Consumer B (offset: 1)     â”‚ â”‚
â”‚  â”‚                     â†‘                   â”€â–º Consumer C (offset: 5)     â”‚ â”‚
â”‚  â”‚                   (persistent log)                                     â”‚ â”‚
â”‚  â”‚  â€¢ Messages persist (configurable retention)                           â”‚ â”‚
â”‚  â”‚  â€¢ Multiple consumers can read same messages                           â”‚ â”‚
â”‚  â”‚  â€¢ Consumers track their own offset                                    â”‚ â”‚
â”‚  â”‚  â€¢ Good for: Event sourcing, replay, multiple subscribers              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  Examples: Kafka, Kinesis, Pulsar                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


DELIVERY GUARANTEES:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AT-MOST-ONCE    â”‚ Fire and forget. May lose messages.                    â”‚
â”‚     ğŸ”¥ â†’  ?     â”‚ Fast, no retries. UDP-style.                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ AT-LEAST-ONCE   â”‚ Retry until ACK. May duplicate.                        â”‚
â”‚    ğŸ”¥ â†’ âœ“ âœ“    â”‚ Need idempotent consumers. Most common.                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ EXACTLY-ONCE    â”‚ Delivered exactly once. Hard/expensive.                â”‚
â”‚     ğŸ”¥ â†’ âœ“     â”‚ Need transactional processing. Kafka transactions.     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PATTERN: At-least-once + Idempotency = Effective exactly-once
```

---

## 9. The Replication Topology Guide

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚       REPLICATION TOPOLOGIES         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


SINGLE-LEADER (Primary-Secondary):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚           Writes                    Reads                                   â”‚
â”‚             â”‚                     â”Œâ”€â”€â”€â”´â”€â”€â”€â”                                â”‚
â”‚             â–¼                     â–¼       â–¼                                â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚        â”‚ PRIMARY â”‚ â”€â”€syncâ”€â”€â–ºâ”‚ REPLICA â”‚ REPLICA â”‚                          â”‚
â”‚        â”‚ (Leader)â”‚  /async  â”‚(Follower)â”‚(Follower)â”‚                         â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                                             â”‚
â”‚  âœ“ Simple, consistent writes                                               â”‚
â”‚  âœ“ Read scaling                                                            â”‚
â”‚  âœ— Write bottleneck on leader                                              â”‚
â”‚  âœ— Failover complexity                                                     â”‚
â”‚                                                                             â”‚
â”‚  USE: Most databases (MySQL, PostgreSQL, MongoDB default)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


MULTI-LEADER (Active-Active):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚         Writes           Writes            Writes                          â”‚
â”‚           â”‚                â”‚                  â”‚                             â”‚
â”‚           â–¼                â–¼                  â–¼                             â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚      â”‚ LEADER  â”‚â—„â”€â”€â”€â”€â–ºâ”‚ LEADER  â”‚â—„â”€â”€â”€â”€â”€â–ºâ”‚ LEADER  â”‚                        â”‚
â”‚      â”‚   US    â”‚      â”‚   EU    â”‚       â”‚  ASIA   â”‚                        â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                                                             â”‚
â”‚  âœ“ Write locally (low latency)                                             â”‚
â”‚  âœ“ Survives region failure                                                 â”‚
â”‚  âœ— Conflict resolution needed                                              â”‚
â”‚  âœ— Complexity in consistency                                               â”‚
â”‚                                                                             â”‚
â”‚  USE: Global applications, CockroachDB, Spanner, multi-region setups       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


LEADERLESS (Dynamo-style):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚           Write to multiple nodes          Read from multiple nodes        â”‚
â”‚                    â”‚                                â”‚                       â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”´â”¬â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”´â”¬â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚           â–¼       â–¼ â–¼       â–¼             â–¼       â–¼ â–¼       â–¼              â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”            â”‚
â”‚        â”‚NODE â”‚ â”‚NODE â”‚ â”‚NODE â”‚         â”‚NODE â”‚ â”‚NODE â”‚ â”‚NODE â”‚            â”‚
â”‚        â”‚  1  â”‚ â”‚  2  â”‚ â”‚  3  â”‚         â”‚  1  â”‚ â”‚  2  â”‚ â”‚  3  â”‚            â”‚
â”‚        â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                             â”‚
â”‚  Quorum: W + R > N                                                         â”‚
â”‚  â€¢ N=3, W=2, R=2 â†’ Overlapping reads/writes = consistency                  â”‚
â”‚                                                                             â”‚
â”‚  âœ“ High availability (no single leader)                                    â”‚
â”‚  âœ“ Write to any node                                                       â”‚
â”‚  âœ— Read repair needed                                                      â”‚
â”‚  âœ— Eventual consistency                                                    â”‚
â”‚                                                                             â”‚
â”‚  USE: Cassandra, Riak, DynamoDB (some modes)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 10. The Sharding Strategy Guide

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚         SHARDING STRATEGIES          â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


HASH-BASED SHARDING:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   user_id = 12345                                                          â”‚
â”‚       â”‚                                                                     â”‚
â”‚       â–¼                                                                     â”‚
â”‚   hash(12345) = 8473628                                                    â”‚
â”‚       â”‚                                                                     â”‚
â”‚       â–¼                                                                     â”‚
â”‚   8473628 % 4 = 0  â”€â”€â–º Shard 0                                             â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚   â”‚ Shard 0 â”‚  â”‚ Shard 1 â”‚  â”‚ Shard 2 â”‚  â”‚ Shard 3 â”‚                       â”‚
â”‚   â”‚ mod = 0 â”‚  â”‚ mod = 1 â”‚  â”‚ mod = 2 â”‚  â”‚ mod = 3 â”‚                       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                                                                             â”‚
â”‚   âœ“ Even distribution                                                      â”‚
â”‚   âœ“ Simple lookup                                                          â”‚
â”‚   âœ— No range queries                                                       â”‚
â”‚   âœ— Resharding is painful (data movement)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


RANGE-BASED SHARDING:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚   â”‚   Shard A   â”‚  â”‚   Shard B   â”‚  â”‚   Shard C   â”‚  â”‚   Shard D   â”‚      â”‚
â”‚   â”‚  A-G users  â”‚  â”‚  H-N users  â”‚  â”‚  O-T users  â”‚  â”‚  U-Z users  â”‚      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                             â”‚
â”‚   âœ“ Range queries possible                                                 â”‚
â”‚   âœ“ Logical grouping                                                       â”‚
â”‚   âœ— Hot spots (if keys aren't uniform)                                     â”‚
â”‚   âœ— Manual rebalancing                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


CONSISTENT HASHING (Solving Resharding):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚                      â”Œâ”€â”€â”€â”€ Node A                                          â”‚
â”‚                     /                                                       â”‚
â”‚                    /     Keys here â†’ Node A                                â”‚
â”‚              â”Œâ”€â”€â”€â”€â—                                                        â”‚
â”‚             /           â”                                                   â”‚
â”‚            /            â”‚                                                   â”‚
â”‚     â—â”€â”€â”€â”€â”€â”˜             â”‚    Ring of hashes                                â”‚
â”‚   Node D                â”‚    (0 to 2^32)                                   â”‚
â”‚            \            â”‚                                                   â”‚
â”‚             \           â”‚                                                   â”‚
â”‚              â””â”€â”€â”€â”€â—     â”˜                                                  â”‚
â”‚                    \                                                        â”‚
â”‚                     \    Keys here â†’ Node B                                â”‚
â”‚                      â””â”€â”€â”€â”€ Node B                                          â”‚
â”‚                                                                             â”‚
â”‚   Adding/removing node only affects neighbors!                             â”‚
â”‚   Virtual nodes (vnodes) for better distribution                           â”‚
â”‚                                                                             â”‚
â”‚   USE: Cassandra, DynamoDB, distributed caches                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


SHARD KEY SELECTION (Critical Decision):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   BAD: Created timestamp                                                   â”‚
â”‚   â””â”€â”€ All new data goes to one shard (hot spot)                            â”‚
â”‚                                                                             â”‚
â”‚   BAD: Sequential ID                                                       â”‚
â”‚   â””â”€â”€ Same problem, latest shard is hot                                    â”‚
â”‚                                                                             â”‚
â”‚   GOOD: User ID                                                            â”‚
â”‚   â””â”€â”€ Distributes users evenly, queries by user stay on one shard          â”‚
â”‚                                                                             â”‚
â”‚   GOOD: Composite key (tenant_id + timestamp)                              â”‚
â”‚   â””â”€â”€ Spreads by tenant, allows time-range queries within tenant           â”‚
â”‚                                                                             â”‚
â”‚   IDEAL SHARD KEY:                                                         â”‚
â”‚   â€¢ High cardinality (many unique values)                                  â”‚
â”‚   â€¢ Even distribution                                                      â”‚
â”‚   â€¢ Matches query patterns (avoid cross-shard queries)                     â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 11. The Resilience Patterns

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚       FAULT TOLERANCE TOOLKIT        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


CIRCUIT BREAKER (Prevent Cascade Failures):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚   â”‚ CLOSED  â”‚ â”€â”€5 â”€â”€â–º â”‚  OPEN   â”‚ â”€â”€waitâ”€â”€â–ºâ”‚HALF-OPENâ”‚                      â”‚
â”‚   â”‚(Normal) â”‚ failuresâ”‚(Failing â”‚  timer  â”‚ (Test)  â”‚                      â”‚
â”‚   â”‚         â”‚         â”‚  Fast)  â”‚         â”‚         â”‚                      â”‚
â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                      â”‚
â”‚        â”‚                   â”‚                    â”‚                           â”‚
â”‚        â”‚                   â”‚              â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”                     â”‚
â”‚        â”‚                   â”‚              â–¼           â–¼                     â”‚
â”‚        â”‚                   â”‚          Success      Failure                  â”‚
â”‚        â”‚                   â”‚              â”‚           â”‚                     â”‚
â”‚        â–²                   â”‚              â–¼           â–¼                     â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€ CLOSED      OPEN                     â”‚
â”‚                                                                             â”‚
â”‚   State Machine:                                                           â”‚
â”‚   â€¢ CLOSED: Requests pass through, count failures                          â”‚
â”‚   â€¢ OPEN: Fail immediately (don't overwhelm failing service)               â”‚
â”‚   â€¢ HALF-OPEN: Allow one request to test if service recovered              â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


RETRY with EXPONENTIAL BACKOFF + JITTER:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   Attempt 1: Fail â”€â”€â–º Wait 1s (+random 0-500ms)                            â”‚
â”‚   Attempt 2: Fail â”€â”€â–º Wait 2s (+random 0-500ms)                            â”‚
â”‚   Attempt 3: Fail â”€â”€â–º Wait 4s (+random 0-500ms)                            â”‚
â”‚   Attempt 4: Fail â”€â”€â–º Wait 8s (+random 0-500ms)                            â”‚
â”‚   Attempt 5: Fail â”€â”€â–º Give up, return error                                â”‚
â”‚                                                                             â”‚
â”‚   delay = min(cap, base * 2^attempt) + random_jitter                       â”‚
â”‚                                                                             â”‚
â”‚   WHY JITTER?                                                              â”‚
â”‚   Without jitter:  1000 clients retry at exactly t=1s, t=2s, t=4s (SPIKE!) â”‚
â”‚   With jitter:     Clients spread out retries (smoother load)              â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


BULKHEAD (Isolate Failures):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   Like ship compartments - one leak doesn't sink the ship                  â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚   â”‚                    YOUR SERVICE                              â”‚          â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚          â”‚
â”‚   â”‚  â”‚Thread Pool A â”‚ â”‚Thread Pool B â”‚ â”‚Thread Pool C â”‚         â”‚          â”‚
â”‚   â”‚  â”‚(Service A)   â”‚ â”‚(Service B)   â”‚ â”‚(Service C)   â”‚         â”‚          â”‚
â”‚   â”‚  â”‚  [|||||||]   â”‚ â”‚  [|||     ]  â”‚ â”‚  [||||||| ]  â”‚         â”‚          â”‚
â”‚   â”‚  â”‚  10 threads  â”‚ â”‚  10 threads  â”‚ â”‚  10 threads  â”‚         â”‚          â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚          â”‚
â”‚   â”‚         â”‚                â”‚                â”‚                  â”‚          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚             â–¼                â–¼                â–¼                             â”‚
â”‚        Service A        Service B        Service C                         â”‚
â”‚        (fast)          (SLOW/DEAD)       (fast)                            â”‚
â”‚                             â”‚                                               â”‚
â”‚                        Service B being slow doesn't exhaust                 â”‚
â”‚                        threads for A and C!                                 â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


TIMEOUT HIERARCHY:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚   â”‚                 REQUEST TIMEOUT (10s)                        â”‚          â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚          â”‚
â”‚   â”‚  â”‚           CONNECTION TIMEOUT (2s)                     â”‚   â”‚          â”‚
â”‚   â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚          â”‚
â”‚   â”‚  â”‚  â”‚         READ TIMEOUT (5s)                      â”‚   â”‚   â”‚          â”‚
â”‚   â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚   â”‚          â”‚
â”‚   â”‚  â”‚  â”‚  â”‚      WRITE TIMEOUT (3s)                 â”‚   â”‚   â”‚   â”‚          â”‚
â”‚   â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚   â”‚          â”‚
â”‚   â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚          â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                             â”‚
â”‚   DEADLINE PROPAGATION:                                                    â”‚
â”‚   If client has 10s deadline, don't start work if only 1s remaining        â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 12. The Rate Limiting Algorithms

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚       RATE LIMITING ALGORITHMS       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


TOKEN BUCKET (Allows Bursts):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚      Tokens added at fixed rate                                            â”‚
â”‚              â”‚                                                              â”‚
â”‚              â–¼                                                              â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                     â”‚
â”‚        â”‚ â— â— â— â— â—   â”‚ Bucket (capacity: 10)                               â”‚
â”‚        â”‚ â— â— â— â— â—   â”‚                                                     â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                     â”‚
â”‚               â”‚                                                             â”‚
â”‚               â–¼                                                             â”‚
â”‚        Request takes 1 token                                               â”‚
â”‚        No token? Rejected.                                                 â”‚
â”‚                                                                             â”‚
â”‚   âœ“ Allows bursts up to bucket size                                        â”‚
â”‚   âœ“ Smooth average rate                                                    â”‚
â”‚                                                                             â”‚
â”‚   Parameters:                                                              â”‚
â”‚   â€¢ Bucket size: 10 (max burst)                                            â”‚
â”‚   â€¢ Refill rate: 5 tokens/second (sustained rate)                          â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


LEAKY BUCKET (Smooth Output):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚        Requests come in (variable rate)                                    â”‚
â”‚              â”‚                                                              â”‚
â”‚              â–¼                                                              â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                     â”‚
â”‚        â”‚ â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹ â”‚ Bucket fills up                                    â”‚
â”‚        â”‚ â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹â‰‹ â”‚ Overflow = rejected                                â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                     â”‚
â”‚               â”‚ â† Leak at constant rate                                    â”‚
â”‚               â–¼                                                             â”‚
â”‚        Processed at fixed rate                                             â”‚
â”‚                                                                             â”‚
â”‚   âœ“ Constant output rate                                                   â”‚
â”‚   âœ“ Smooths traffic spikes                                                 â”‚
â”‚   âœ— No bursts allowed                                                      â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


FIXED WINDOW:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   Window 1 (0:00-0:59)     Window 2 (1:00-1:59)                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚   â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (100)  â”‚ â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (60)         â”‚                          â”‚
â”‚   â”‚ Limit: 100/minute   â”‚ â”‚ Limit: 100/minute   â”‚                          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                                             â”‚
â”‚   Problem: Edge burst                                                      â”‚
â”‚   â€¢ 100 requests at 0:59                                                   â”‚
â”‚   â€¢ 100 requests at 1:00                                                   â”‚
â”‚   â€¢ = 200 in 2 seconds! (window boundary)                                  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


SLIDING WINDOW LOG:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   Store timestamp of each request                                          â”‚
â”‚                                                                             â”‚
â”‚   Request at 1:00:45                                                       â”‚
â”‚   â””â”€â–º Count requests from 0:59:45 to 1:00:45                               â”‚
â”‚       â”‚                                                                     â”‚
â”‚       â””â”€â–º [0:59:50, 0:59:55, 1:00:10, 1:00:30, 1:00:45]                    â”‚
â”‚           5 requests in window                                             â”‚
â”‚           Limit: 100? â†’ ALLOW                                              â”‚
â”‚                                                                             â”‚
â”‚   âœ“ Accurate (no boundary issues)                                          â”‚
â”‚   âœ— Memory intensive (store all timestamps)                                â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


SLIDING WINDOW COUNTER (Best of Both):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   Current window: 70 requests                                              â”‚
â”‚   Previous window: 40 requests                                             â”‚
â”‚   Current position: 25% into window                                        â”‚
â”‚                                                                             â”‚
â”‚   Weighted count = 70 + (40 Ã— 0.75) = 100                                  â”‚
â”‚                    â””â”€currentâ”€â”˜  â””â”€prev Ã— overlapâ”€â”˜                         â”‚
â”‚                                                                             â”‚
â”‚   âœ“ Low memory (just counters)                                             â”‚
â”‚   âœ“ Handles boundary better than fixed                                     â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


ALGORITHM SELECTION:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   Allow bursts?                                                            â”‚
â”‚       â”‚                                                                     â”‚
â”‚       â”œâ”€â”€ YES â”€â”€â–º TOKEN BUCKET                                             â”‚
â”‚       â”‚                                                                     â”‚
â”‚       â””â”€â”€ NO â”€â”€â–º Need constant rate? â”€â”€â–º LEAKY BUCKET                      â”‚
â”‚                           â”‚                                                 â”‚
â”‚                           â””â”€â”€ Need accuracy? â”€â”€â–º SLIDING WINDOW            â”‚
â”‚                                      â”‚                                      â”‚
â”‚                                      â””â”€â”€ Memory constrained?               â”‚
â”‚                                              â”‚                              â”‚
â”‚                                              â”œâ”€â”€ YES â”€â”€â–º SLIDING COUNTER   â”‚
â”‚                                              â””â”€â”€ NO â”€â”€â–º SLIDING LOG        â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 13. The Distributed Transaction Patterns

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    DISTRIBUTED TRANSACTION OPTIONS   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


TWO-PHASE COMMIT (2PC):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   PHASE 1: PREPARE                     PHASE 2: COMMIT                     â”‚
â”‚                                                                             â”‚
â”‚        Coordinator                          Coordinator                    â”‚
â”‚            â”‚                                    â”‚                          â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”                        â”Œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”                    â”‚
â”‚      â”‚     â”‚     â”‚ "Can you commit?"      â”‚     â”‚     â”‚ "Do commit!"      â”‚
â”‚      â–¼     â–¼     â–¼                        â–¼     â–¼     â–¼                    â”‚
â”‚    â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â”                    â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â”                  â”‚
â”‚    â”‚DB1â”‚ â”‚DB2â”‚ â”‚DB3â”‚                    â”‚DB1â”‚ â”‚DB2â”‚ â”‚DB3â”‚                  â”‚
â”‚    â””â”€â”¬â”€â”˜ â””â”€â”¬â”€â”˜ â””â”€â”¬â”€â”˜                    â””â”€â”¬â”€â”˜ â””â”€â”¬â”€â”˜ â””â”€â”¬â”€â”˜                  â”‚
â”‚      â”‚     â”‚     â”‚                        â”‚     â”‚     â”‚                    â”‚
â”‚      â””â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”˜                        â””â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚            â”‚                                    â”‚                          â”‚
â”‚      All say YES?                         All commit!                      â”‚
â”‚                                                                             â”‚
â”‚   âœ“ Strong consistency                                                     â”‚
â”‚   âœ— Blocking (coordinator failure = stuck)                                 â”‚
â”‚   âœ— Performance penalty                                                    â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


SAGA PATTERN (Long-Running Transactions):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   Order Saga (E-commerce):                                                 â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚ 1. Create  â”‚â”€â”€â”€â–ºâ”‚ 2. Reserve â”‚â”€â”€â”€â–ºâ”‚ 3. Process â”‚â”€â”€â”€â–ºâ”‚ 4. Ship    â”‚    â”‚
â”‚   â”‚    Order   â”‚    â”‚   Inventoryâ”‚    â”‚   Payment  â”‚    â”‚    Order   â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚         â”‚                 â”‚                 â”‚                 â”‚            â”‚
â”‚         â–¼                 â–¼                 â–¼                 â–¼            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚ COMPENSATE â”‚â—„â”€â”€â”€â”‚ COMPENSATE â”‚â—„â”€â”€â”€â”‚ COMPENSATE â”‚â—„â”€â”€â”€â”‚ (no comp)  â”‚    â”‚
â”‚   â”‚Cancel Orderâ”‚    â”‚Release Inv â”‚    â”‚Refund Pay  â”‚    â”‚            â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                             â”‚
â”‚   If step 3 fails â†’ Run compensations 2, 1 (in reverse)                   â”‚
â”‚                                                                             â”‚
â”‚   CHOREOGRAPHY:  Services react to events (decentralized)                  â”‚
â”‚   ORCHESTRATION: Central coordinator directs (centralized)                 â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


OUTBOX PATTERN (Reliable Event Publishing):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   Problem: How to update DB AND send message atomically?                   â”‚
â”‚                                                                             â”‚
â”‚   BAD:                                                                     â”‚
â”‚   1. Update DB âœ“                                                           â”‚
â”‚   2. Send message âœ— (crash here = inconsistent)                            â”‚
â”‚                                                                             â”‚
â”‚   SOLUTION - OUTBOX:                                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚   â”‚                  SAME TRANSACTION                         â”‚             â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚             â”‚
â”‚   â”‚  â”‚  Update Orders  â”‚     â”‚  Insert into    â”‚             â”‚             â”‚
â”‚   â”‚  â”‚     Table       â”‚     â”‚  Outbox Table   â”‚             â”‚             â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚             â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                      â”‚                                      â”‚
â”‚                                      â–¼                                      â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚                         â”‚ Background Worker   â”‚                            â”‚
â”‚                         â”‚ reads outbox,       â”‚                            â”‚
â”‚                         â”‚ publishes to queue  â”‚                            â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 14. The Architecture Patterns

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚      ARCHITECTURE DECISION TREE      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚ What's your context?â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼                          â–¼                          â–¼
   Small Team              Growing Team                Large Org
   (< 5 devs)              (5-20 devs)               (20+ devs)
   Simple Domain           Complex Domain            Multi-Team
         â”‚                          â”‚                          â”‚
         â–¼                          â–¼                          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ MONOLITH  â”‚            â”‚   MODULAR     â”‚          â”‚ MICROSERVICES â”‚
   â”‚           â”‚            â”‚   MONOLITH    â”‚          â”‚               â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


MONOLITH â†’ MICROSERVICES EVOLUTION:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚  Stage 1: Monolith              Stage 2: Modular Monolith                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â”‚            â”‚ â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”    â”‚                â”‚
â”‚  â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â”‚    â”€â”€â”€â–º    â”‚ â”‚Auth â”‚Orderâ”‚Ship â”‚    â”‚                â”‚
â”‚  â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â”‚            â”‚ â”‚ mod â”‚ mod â”‚ mod â”‚    â”‚                â”‚
â”‚  â”‚  Spaghetti     â”‚            â”‚ â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜    â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚     Internal APIs      â”‚                â”‚
â”‚                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                             â”‚
â”‚  Stage 3: Strangler Fig         Stage 4: Microservices                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚                         â”‚                â”‚
â”‚  â”‚ â”‚  Legacy Monolith â”‚    â”‚    â”‚  â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”  â”‚                â”‚
â”‚  â”‚ â”‚  (shrinking)     â”‚    â”‚    â”‚  â”‚Authâ”‚ â”‚Orderâ”‚ â”‚Shipâ”‚  â”‚                â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚  â”‚ Î¼s â”‚ â”‚ Î¼s â”‚ â”‚ Î¼s â”‚  â”‚                â”‚
â”‚  â”‚          â†•              â”‚    â”‚  â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜  â”‚                â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”          â”‚    â”‚     â†•       â†•       â†•   â”‚                â”‚
â”‚  â”‚ â”‚New â”‚ â”‚New â”‚          â”‚    â”‚  â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”  â”‚                â”‚
â”‚  â”‚ â”‚ Î¼s â”‚ â”‚ Î¼s â”‚          â”‚    â”‚  â”‚Pay â”‚ â”‚Inv â”‚ â”‚Notifâ”‚  â”‚                â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜          â”‚    â”‚  â”‚ Î¼s â”‚ â”‚ Î¼s â”‚ â”‚ Î¼s â”‚  â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜  â”‚                â”‚
â”‚                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


EVENT-DRIVEN ARCHITECTURE:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   Traditional (Request/Response):                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  request  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  request  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚   â”‚Service â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚Service â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚Service â”‚                    â”‚
â”‚   â”‚   A    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   B    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   C    â”‚                    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  response â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  response â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                                             â”‚
â”‚   Event-Driven:                                                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚   â”‚Service â”‚â”€â”€eventâ”€â”€â”€â–ºâ”‚       EVENT BUS             â”‚                    â”‚
â”‚   â”‚   A    â”‚           â”‚  (Kafka/EventBridge/SNS)    â”‚                    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚                         â–¼          â–¼          â–¼                            â”‚
â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚                     â”‚Service â”‚ â”‚Service â”‚ â”‚Service â”‚                      â”‚
â”‚                     â”‚   B    â”‚ â”‚   C    â”‚ â”‚   D    â”‚                      â”‚
â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                                                             â”‚
â”‚   âœ“ Loose coupling                                                         â”‚
â”‚   âœ“ Scalability                                                            â”‚
â”‚   âœ“ Resilience                                                             â”‚
â”‚   âœ— Eventual consistency                                                   â”‚
â”‚   âœ— Debugging complexity                                                   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


CQRS (Command Query Responsibility Segregation):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚                        â”‚     CLIENT      â”‚                                 â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚                                 â”‚                                          â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚              â–¼                                     â–¼                       â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚     â”‚    COMMANDS     â”‚                   â”‚     QUERIES     â”‚              â”‚
â”‚     â”‚ (Create, Update)â”‚                   â”‚ (Read, Search)  â”‚              â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚              â”‚                                     â”‚                       â”‚
â”‚              â–¼                                     â–¼                       â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚     â”‚  WRITE MODEL    â”‚â”€â”€â”€â”€â”€ events â”€â”€â”€â”€â”€â–ºâ”‚   READ MODEL    â”‚              â”‚
â”‚     â”‚ (Normalized,    â”‚     (async)       â”‚ (Denormalized,  â”‚              â”‚
â”‚     â”‚  consistent)    â”‚                   â”‚  fast reads)    â”‚              â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                             â”‚
â”‚   USE: Read/write patterns differ significantly                            â”‚
â”‚   â€¢ Reads: 1000x more than writes                                          â”‚
â”‚   â€¢ Reads: Need denormalized views                                         â”‚
â”‚   â€¢ Writes: Need complex validations                                       â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 15. The Observability Stack

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚        THE THREE PILLARS (+1)        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


            METRICS              LOGS                TRACES           PROFILES
         (What happened?)   (Why happened?)    (Where happened?)   (How fast?)
               â”‚                  â”‚                   â”‚                  â”‚
               â–¼                  â–¼                   â–¼                  â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Numbers  â”‚       â”‚ Events   â”‚       â”‚ Requests â”‚       â”‚ CPU/Mem  â”‚
         â”‚ over timeâ”‚       â”‚ with     â”‚       â”‚ across   â”‚       â”‚ Analysis â”‚
         â”‚          â”‚       â”‚ context  â”‚       â”‚ services â”‚       â”‚          â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                  â”‚                   â”‚                  â”‚
         â”‚ Examples:        â”‚ Examples:         â”‚ Examples:        â”‚ Examples:
         â”‚ â€¢ CPU %          â”‚ â€¢ Error stack     â”‚ â€¢ API â†’ DB       â”‚ â€¢ Flame
         â”‚ â€¢ Request/sec    â”‚ â€¢ User actions    â”‚ â€¢ Latency        â”‚   graphs
         â”‚ â€¢ Error rate     â”‚ â€¢ Debug info      â”‚   breakdown      â”‚ â€¢ Hot paths
         â”‚                  â”‚                   â”‚                  â”‚
         â–¼                  â–¼                   â–¼                  â–¼
    Prometheus         ELK Stack            Jaeger/Zipkin       Pyroscope
    Datadog           Grafana Loki         OpenTelemetry         Parca
    CloudWatch        Splunk               X-Ray                Datadog


GOLDEN SIGNALS (What to Monitor):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   1. LATENCY         Time to serve a request                               â”‚
â”‚      â”œâ”€â”€ P50: Median user experience                                       â”‚
â”‚      â”œâ”€â”€ P95: Most users                                                   â”‚
â”‚      â”œâ”€â”€ P99: Worst experiences (important!)                               â”‚
â”‚      â””â”€â”€ Distinguish: Success vs error latency                             â”‚
â”‚                                                                             â”‚
â”‚   2. TRAFFIC         Demand on system                                      â”‚
â”‚      â”œâ”€â”€ Requests per second                                               â”‚
â”‚      â”œâ”€â”€ Active connections                                                â”‚
â”‚      â””â”€â”€ Messages processed                                                â”‚
â”‚                                                                             â”‚
â”‚   3. ERRORS          Rate of failed requests                               â”‚
â”‚      â”œâ”€â”€ HTTP 5xx rate                                                     â”‚
â”‚      â”œâ”€â”€ Exception rate                                                    â”‚
â”‚      â””â”€â”€ Business logic errors                                             â”‚
â”‚                                                                             â”‚
â”‚   4. SATURATION      How "full" is the system                              â”‚
â”‚      â”œâ”€â”€ CPU utilization                                                   â”‚
â”‚      â”œâ”€â”€ Memory usage                                                      â”‚
â”‚      â”œâ”€â”€ Queue depth                                                       â”‚
â”‚      â””â”€â”€ Thread pool exhaustion                                            â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


SLI â†’ SLO â†’ SLA:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   SLI (Indicator)          SLO (Objective)          SLA (Agreement)        â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚
â”‚   What you measure         What you target          What you promise       â”‚
â”‚                                                                             â”‚
â”‚   â€¢ 99.5% success rate     â€¢ 99.9% success         â€¢ 99.9% uptime         â”‚
â”‚   â€¢ P99 latency = 200ms    â€¢ P99 < 300ms           â€¢ < 500ms latency      â”‚
â”‚                            â€¢ 99.95% available      â€¢ Credits if breached  â”‚
â”‚                                                                             â”‚
â”‚   ERROR BUDGET:                                                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚   â”‚ SLO: 99.9% availability = 0.1% error budget                     â”‚      â”‚
â”‚   â”‚ Per month: 43.2 minutes of downtime allowed                     â”‚      â”‚
â”‚   â”‚                                                                  â”‚      â”‚
â”‚   â”‚ Used: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ (35 min)                             â”‚      â”‚
â”‚   â”‚ Remaining: 8.2 minutes                                          â”‚      â”‚
â”‚   â”‚                                                                  â”‚      â”‚
â”‚   â”‚ POLICY: If budget exhausted â†’ freeze features, focus stability â”‚      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 16. The Security Mental Model

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚        DEFENSE IN DEPTH              â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚   ATTACKER  â”‚
                              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚         EDGE PROTECTION          â”‚
                    â”‚   DDoS mitigation, WAF, CDN     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚         NETWORK LAYER           â”‚
                    â”‚   Firewalls, VPN, VPC, Segments â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚         IDENTITY LAYER          â”‚
                    â”‚   Authentication, SSO, MFA      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚        APPLICATION LAYER        â”‚
                    â”‚   Input validation, RBAC, ABAC  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚           DATA LAYER            â”‚
                    â”‚   Encryption, Masking, Backups  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                              â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                              â”‚   ASSETS    â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


AUTHENTICATION vs AUTHORIZATION:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   AUTHENTICATION (AuthN)              AUTHORIZATION (AuthZ)                â”‚
â”‚   "WHO are you?"                      "WHAT can you do?"                   â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚   â”‚ â€¢ Username/pwd   â”‚               â”‚ â€¢ RBAC (Roles)   â”‚                  â”‚
â”‚   â”‚ â€¢ OAuth/OIDC     â”‚               â”‚ â€¢ ABAC (Attribs) â”‚                  â”‚
â”‚   â”‚ â€¢ JWT tokens     â”‚               â”‚ â€¢ ReBAC (Relns)  â”‚                  â”‚
â”‚   â”‚ â€¢ Passkeys/FIDO  â”‚               â”‚ â€¢ Policy engines â”‚                  â”‚
â”‚   â”‚ â€¢ MFA            â”‚               â”‚   (OPA, Cedar)   â”‚                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                             â”‚
â”‚   Flow:                                                                    â”‚
â”‚   1. User presents credentials (AuthN)                                     â”‚
â”‚   2. System verifies identity âœ“                                            â”‚
â”‚   3. User requests resource                                                â”‚
â”‚   4. System checks permissions (AuthZ)                                     â”‚
â”‚   5. Access granted or denied                                              â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


ZERO TRUST PRINCIPLES:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   OLD: Castle-and-moat (trust internal network)                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚   â”‚ TRUSTED INTERNAL NETWORK              â”‚                                â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â”            â”‚ â† Firewall                     â”‚
â”‚   â”‚   â”‚ S â”‚ â”‚ S â”‚ â”‚ S â”‚ â”‚ S â”‚            â”‚                                â”‚
â”‚   â”‚   â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜            â”‚                                â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                                                             â”‚
â”‚   NEW: Zero Trust (trust nothing, verify everything)                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                                â”‚
â”‚   â”‚   â”‚ â”Œâ”€â”€â”€â” verify â”Œâ”€â”€â”€â” verify â”Œâ”€â”€â”€â”â”‚  â”‚                                â”‚
â”‚   â”‚   â”‚ â”‚ S â”‚â—„â”€â”€â”€â”€â”€â”€â–ºâ”‚ S â”‚â—„â”€â”€â”€â”€â”€â”€â–ºâ”‚ S â”‚â”‚  â”‚                                â”‚
â”‚   â”‚   â”‚ â””â”€â”€â”€â”˜        â””â”€â”€â”€â”˜        â””â”€â”€â”€â”˜â”‚  â”‚                                â”‚
â”‚   â”‚   â”‚     Every request verified     â”‚  â”‚                                â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                                â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                                                             â”‚
â”‚   Principles:                                                              â”‚
â”‚   1. Never trust, always verify                                            â”‚
â”‚   2. Assume breach                                                         â”‚
â”‚   3. Verify explicitly                                                     â”‚
â”‚   4. Least privilege access                                                â”‚
â”‚   5. Micro-segmentation                                                    â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 17. The Back-of-Envelope Calculations

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚      NUMBERS EVERY DEV SHOULD KNOW  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


LATENCY NUMBERS (2024):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   L1 cache reference                           0.5 ns                      â”‚
â”‚   L2 cache reference                             7 ns                      â”‚
â”‚   Main memory reference                        100 ns                      â”‚
â”‚   SSD random read                           16,000 ns  (16 Î¼s)             â”‚
â”‚   HDD seek                                4,000,000 ns  (4 ms)             â”‚
â”‚   Network round-trip (same datacenter)      500,000 ns  (0.5 ms)           â”‚
â”‚   Network round-trip (CA â†’ Netherlands)  150,000,000 ns (150 ms)           â”‚
â”‚                                                                             â”‚
â”‚   VISUAL:                                                                  â”‚
â”‚   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚
â”‚   L1   L2    RAM          SSD               HDD         Network (DC)      â”‚
â”‚   Â·    Â·     â”‚            â–ˆâ–ˆâ–ˆâ–ˆ              â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ      â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


QUICK CAPACITY ESTIMATES:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   TIME CONVERSIONS:                                                        â”‚
â”‚   â€¢ 1 day = 86,400 seconds â‰ˆ 100,000 seconds                              â”‚
â”‚   â€¢ 1 year = 31.5 million seconds â‰ˆ 30 million                            â”‚
â”‚                                                                             â”‚
â”‚   STORAGE:                                                                 â”‚
â”‚   â€¢ 1 million users Ã— 1 KB profile = 1 GB                                 â”‚
â”‚   â€¢ 1 billion rows Ã— 1 KB = 1 TB                                          â”‚
â”‚   â€¢ 1 million images Ã— 200 KB = 200 GB                                    â”‚
â”‚                                                                             â”‚
â”‚   THROUGHPUT:                                                              â”‚
â”‚   â€¢ 1 million DAU, each makes 10 requests = 10M requests/day              â”‚
â”‚   â€¢ 10M / 100,000 seconds = 100 QPS (average)                             â”‚
â”‚   â€¢ Peak = 3-5x average = 300-500 QPS                                     â”‚
â”‚                                                                             â”‚
â”‚   BANDWIDTH:                                                               â”‚
â”‚   â€¢ 100 QPS Ã— 10 KB response = 1 MB/s = 8 Mbps                           â”‚
â”‚   â€¢ 1000 QPS Ã— 100 KB = 100 MB/s = 800 Mbps                              â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


ESTIMATION FRAMEWORK:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   STEP 1: Users and Activity                                               â”‚
â”‚   â”œâ”€â”€ DAU/MAU                                                              â”‚
â”‚   â”œâ”€â”€ Actions per user per day                                             â”‚
â”‚   â””â”€â”€ Read/write ratio                                                     â”‚
â”‚                                                                             â”‚
â”‚   STEP 2: Requests Per Second                                              â”‚
â”‚   â”œâ”€â”€ Total requests = DAU Ã— actions                                       â”‚
â”‚   â”œâ”€â”€ Average QPS = requests / 86,400                                      â”‚
â”‚   â””â”€â”€ Peak QPS = average Ã— 3 to 5                                          â”‚
â”‚                                                                             â”‚
â”‚   STEP 3: Storage                                                          â”‚
â”‚   â”œâ”€â”€ Per-item size (metadata + content)                                   â”‚
â”‚   â”œâ”€â”€ Daily growth = items Ã— size                                          â”‚
â”‚   â””â”€â”€ 5-year storage = daily Ã— 365 Ã— 5 Ã— replication                       â”‚
â”‚                                                                             â”‚
â”‚   STEP 4: Bandwidth                                                        â”‚
â”‚   â”œâ”€â”€ Request bandwidth = QPS Ã— request size                               â”‚
â”‚   â””â”€â”€ Response bandwidth = QPS Ã— response size                             â”‚
â”‚                                                                             â”‚
â”‚   STEP 5: Memory (Cache)                                                   â”‚
â”‚   â”œâ”€â”€ Working set size (hot data)                                          â”‚
â”‚   â””â”€â”€ Cache memory = working set Ã— overhead                                â”‚
â”‚                                                                             â”‚
â”‚   EXAMPLE: Twitter-like service                                            â”‚
â”‚   â”œâ”€â”€ 500M DAU, 5 tweets viewed/day = 2.5B reads/day                       â”‚
â”‚   â”œâ”€â”€ Average: 2.5B / 86,400 â‰ˆ 30,000 read QPS                            â”‚
â”‚   â”œâ”€â”€ Peak: 30,000 Ã— 3 = 90,000 QPS                                       â”‚
â”‚   â”œâ”€â”€ Storage: 500M users Ã— 5 tweets/day Ã— 280 bytes Ã— 365 days = 255 TB  â”‚
â”‚   â””â”€â”€ Cache: Top 20% tweets (80/20 rule) = 51 TB in cache                 â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 18. The System Design Interview Framework

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     SYSTEM DESIGN INTERVIEW FLOW    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


STEP 1: REQUIREMENTS (5 min)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   FUNCTIONAL                          NON-FUNCTIONAL                       â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                       â”‚
â”‚   â€¢ What features?                    â€¢ Scale (users, data)                â”‚
â”‚   â€¢ Core use cases?                   â€¢ Latency requirements               â”‚
â”‚   â€¢ What's MVP?                       â€¢ Availability (99.9%?)              â”‚
â”‚   â€¢ Any constraints?                  â€¢ Consistency needs                  â”‚
â”‚                                       â€¢ Read/write ratio                   â”‚
â”‚                                                                             â”‚
â”‚   QUESTIONS TO ASK:                                                        â”‚
â”‚   â€¢ "What's the scale we're designing for?"                                â”‚
â”‚   â€¢ "What's the read/write ratio?"                                         â”‚
â”‚   â€¢ "Do we need strong consistency?"                                       â”‚
â”‚   â€¢ "What's the latency requirement?"                                      â”‚
â”‚   â€¢ "Is this global or single region?"                                     â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


STEP 2: CAPACITY ESTIMATION (5 min)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   "Let me do some quick math..."                                           â”‚
â”‚                                                                             â”‚
â”‚   TRAFFIC:                                                                 â”‚
â”‚   â€¢ DAU: 100M                                                              â”‚
â”‚   â€¢ Requests/user/day: 10                                                  â”‚
â”‚   â€¢ Total: 1B requests/day                                                 â”‚
â”‚   â€¢ QPS: 1B / 86400 â‰ˆ 12,000                                               â”‚
â”‚   â€¢ Peak QPS: 12,000 Ã— 3 = 36,000                                          â”‚
â”‚                                                                             â”‚
â”‚   STORAGE:                                                                 â”‚
â”‚   â€¢ Data per item: 1 KB                                                    â”‚
â”‚   â€¢ Items per day: 10M                                                     â”‚
â”‚   â€¢ Daily storage: 10 GB                                                   â”‚
â”‚   â€¢ 5-year storage: 10 GB Ã— 365 Ã— 5 = 18 TB                               â”‚
â”‚                                                                             â”‚
â”‚   BANDWIDTH:                                                               â”‚
â”‚   â€¢ 36,000 QPS Ã— 10 KB = 360 MB/s                                         â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


STEP 3: HIGH-LEVEL DESIGN (10 min)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   Draw the big picture first, explain as you go:                           â”‚
â”‚                                                                             â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚        â”‚ Clients  â”‚                                                        â”‚
â”‚        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚             â”‚                                                               â”‚
â”‚        â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                                                         â”‚
â”‚        â”‚   CDN   â”‚ (static content)                                        â”‚
â”‚        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                                         â”‚
â”‚             â”‚                                                               â”‚
â”‚        â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                                                         â”‚
â”‚        â”‚Load Bal â”‚                                                         â”‚
â”‚        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                                         â”‚
â”‚             â”‚                                                               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                    â”‚
â”‚   â–¼         â–¼         â–¼                                                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”                                                  â”‚
â”‚ â”‚API â”‚   â”‚API â”‚   â”‚API â”‚ (stateless)                                      â”‚
â”‚ â””â”€â”€â”¬â”€â”˜   â””â”€â”€â”¬â”€â”˜   â””â”€â”€â”¬â”€â”˜                                                  â”‚
â”‚    â”‚        â”‚        â”‚                                                     â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                     â”‚
â”‚             â”‚                                                               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                    â”‚
â”‚   â–¼         â–¼         â–¼                                                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”                                                  â”‚
â”‚ â”‚Cacheâ”‚  â”‚Queueâ”‚  â”‚ DB â”‚                                                  â”‚
â”‚ â””â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”˜                                                  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


STEP 4: DEEP DIVE (15 min)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   Pick 2-3 components to detail based on interviewer interest:             â”‚
â”‚                                                                             â”‚
â”‚   DATABASE:                                                                â”‚
â”‚   â€¢ Schema design                                                          â”‚
â”‚   â€¢ Indexing strategy                                                      â”‚
â”‚   â€¢ Sharding approach                                                      â”‚
â”‚   â€¢ Replication topology                                                   â”‚
â”‚                                                                             â”‚
â”‚   CACHING:                                                                 â”‚
â”‚   â€¢ What to cache                                                          â”‚
â”‚   â€¢ Invalidation strategy                                                  â”‚
â”‚   â€¢ Cache-aside vs write-through                                           â”‚
â”‚                                                                             â”‚
â”‚   SCALING:                                                                 â”‚
â”‚   â€¢ Horizontal scaling                                                     â”‚
â”‚   â€¢ Load balancing algorithm                                               â”‚
â”‚   â€¢ Database scaling                                                       â”‚
â”‚                                                                             â”‚
â”‚   RELIABILITY:                                                             â”‚
â”‚   â€¢ Failure scenarios                                                      â”‚
â”‚   â€¢ Circuit breakers                                                       â”‚
â”‚   â€¢ Retry strategies                                                       â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


STEP 5: TRADE-OFFS & WRAP-UP (5-10 min)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   Discuss trade-offs you made:                                             â”‚
â”‚                                                                             â”‚
â”‚   "I chose eventual consistency because..."                                â”‚
â”‚   "We could use SQL but NoSQL gives us..."                                 â”‚
â”‚   "If we had more time, I'd add..."                                        â”‚
â”‚                                                                             â”‚
â”‚   Address potential issues:                                                â”‚
â”‚   â€¢ Single points of failure                                               â”‚
â”‚   â€¢ Bottlenecks                                                            â”‚
â”‚   â€¢ Cost considerations                                                    â”‚
â”‚                                                                             â”‚
â”‚   Future improvements:                                                     â”‚
â”‚   â€¢ Multi-region                                                           â”‚
â”‚   â€¢ Better caching                                                         â”‚
â”‚   â€¢ Analytics pipeline                                                     â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 19. Common Design Problems - Quick Patterns

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       DESIGN PROBLEM CHEAT SHEET                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   URL SHORTENER                                                            â”‚
â”‚   â””â”€â”€ Hash function + Counter + Base62 encoding + Cache + NoSQL            â”‚
â”‚                                                                             â”‚
â”‚   RATE LIMITER                                                             â”‚
â”‚   â””â”€â”€ Token bucket / Sliding window + Redis + Distributed sync             â”‚
â”‚                                                                             â”‚
â”‚   NEWS FEED                                                                â”‚
â”‚   â””â”€â”€ Fan-out (push vs pull hybrid) + Cache + Timeline service             â”‚
â”‚                                                                             â”‚
â”‚   CHAT SYSTEM                                                              â”‚
â”‚   â””â”€â”€ WebSocket + Presence service + Message queue + NoSQL                 â”‚
â”‚                                                                             â”‚
â”‚   NOTIFICATION SYSTEM                                                      â”‚
â”‚   â””â”€â”€ Message queue + Priority + Rate limiting + Multiple channels         â”‚
â”‚                                                                             â”‚
â”‚   SEARCH AUTOCOMPLETE                                                      â”‚
â”‚   â””â”€â”€ Trie + Prefix cache + Top-K + Distributed aggregation                â”‚
â”‚                                                                             â”‚
â”‚   VIDEO STREAMING                                                          â”‚
â”‚   â””â”€â”€ CDN + Chunking + Adaptive bitrate + Async transcoding                â”‚
â”‚                                                                             â”‚
â”‚   FILE STORAGE (Dropbox)                                                   â”‚
â”‚   â””â”€â”€ Chunking + Dedup + Sync protocol + Object storage                    â”‚
â”‚                                                                             â”‚
â”‚   RIDE-SHARING                                                             â”‚
â”‚   â””â”€â”€ Geohash + Quadtree + Real-time matching + ETA prediction             â”‚
â”‚                                                                             â”‚
â”‚   PAYMENT SYSTEM                                                           â”‚
â”‚   â””â”€â”€ Idempotency + Saga + Ledger + Reconciliation                         â”‚
â”‚                                                                             â”‚
â”‚   METRICS SYSTEM                                                           â”‚
â”‚   â””â”€â”€ Time-series DB + Aggregation + Downsampling + Alerting               â”‚
â”‚                                                                             â”‚
â”‚   DISTRIBUTED CACHE                                                        â”‚
â”‚   â””â”€â”€ Consistent hashing + Replication + Eviction + Hot key handling       â”‚
â”‚                                                                             â”‚
â”‚   JOB SCHEDULER                                                            â”‚
â”‚   â””â”€â”€ Priority queue + DAG + Retry + Idempotency + Dead letter             â”‚
â”‚                                                                             â”‚
â”‚   WEB CRAWLER                                                              â”‚
â”‚   â””â”€â”€ URL frontier + Politeness + Dedup + DNS cache + Distributed          â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 20. The Learning Path

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚       SYSTEM DESIGN MASTERY PATH     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


PHASE 1: FOUNDATIONS (Weeks 1-4)
â”œâ”€â”€ Scaling basics (horizontal/vertical)
â”œâ”€â”€ Load balancing algorithms
â”œâ”€â”€ Caching strategies
â”œâ”€â”€ Database basics (SQL vs NoSQL)
â”œâ”€â”€ CAP theorem
â””â”€â”€ Back-of-envelope calculations

PHASE 2: DISTRIBUTED SYSTEMS (Weeks 5-8)
â”œâ”€â”€ Consistency models
â”œâ”€â”€ Replication strategies
â”œâ”€â”€ Sharding patterns
â”œâ”€â”€ Consensus (Raft, Paxos basics)
â”œâ”€â”€ Message queues vs streams
â””â”€â”€ Distributed transactions

PHASE 3: ARCHITECTURE (Weeks 9-12)
â”œâ”€â”€ Microservices patterns
â”œâ”€â”€ Event-driven architecture
â”œâ”€â”€ API design (REST, GraphQL, gRPC)
â”œâ”€â”€ Service mesh concepts
â”œâ”€â”€ CQRS and Event Sourcing
â””â”€â”€ Serverless patterns

PHASE 4: RELIABILITY (Weeks 13-16)
â”œâ”€â”€ Fault tolerance patterns
â”œâ”€â”€ Rate limiting algorithms
â”œâ”€â”€ Circuit breakers
â”œâ”€â”€ Chaos engineering
â”œâ”€â”€ DR strategies
â””â”€â”€ SLI/SLO/SLA

PHASE 5: PRACTICE (Ongoing)
â”œâ”€â”€ Design 2-3 systems per week
â”œâ”€â”€ Review real-world architectures
â”œâ”€â”€ Mock interviews
â””â”€â”€ Study company tech blogs


RECOMMENDED RESOURCES:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BOOKS:                                                                      â”‚
â”‚ â€¢ Designing Data-Intensive Applications (Kleppmann) - THE BIBLE            â”‚
â”‚ â€¢ System Design Interview Vol 1 & 2 (Alex Xu)                              â”‚
â”‚ â€¢ Building Microservices (Newman)                                          â”‚
â”‚                                                                             â”‚
â”‚ PRACTICE:                                                                   â”‚
â”‚ â€¢ Design one system per day                                                â”‚
â”‚ â€¢ Explain to rubber duck / peer                                            â”‚
â”‚ â€¢ Write design docs                                                        â”‚
â”‚                                                                             â”‚
â”‚ BLOGS:                                                                      â”‚
â”‚ â€¢ Netflix Tech Blog                                                        â”‚
â”‚ â€¢ Uber Engineering                                                         â”‚
â”‚ â€¢ Meta Engineering                                                         â”‚
â”‚ â€¢ AWS Architecture Blog                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Quick Reference Card

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SYSTEM DESIGN QUICK REFERENCE                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚ SCALING:        Stateless services + Load balancer + Auto-scale            â”‚
â”‚ DATABASE:       SQL (ACID) vs NoSQL (Scale) - pick based on access pattern â”‚
â”‚ CACHING:        Cache-aside + TTL + Consistent hashing                     â”‚
â”‚ MESSAGING:      Queue (task) vs Stream (event) vs Pub/Sub (fan-out)        â”‚
â”‚ CONSISTENCY:    Strong (finance) vs Eventual (social) based on need        â”‚
â”‚ AVAILABILITY:   Multi-AZ + Health checks + Failover                        â”‚
â”‚ RELIABILITY:    Circuit breaker + Retry + Timeout + Bulkhead               â”‚
â”‚ SECURITY:       HTTPS + Auth + Least privilege + Encryption                â”‚
â”‚ MONITORING:     Metrics + Logs + Traces + Alerts                           â”‚
â”‚                                                                             â”‚
â”‚ THE FORMULA:                                                               â”‚
â”‚ Good System = Right Trade-offs + Scalable + Reliable + Simple              â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
